
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Transaktionen verwalten</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.6/dist/umd/supabase.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #1e1e1e; color: white; padding: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; background-color: #333; }
        th, td { border: 1px solid #666; padding: 8px; text-align: left; }
        th { background-color: #444; }
        input, select, button { padding: 5px; margin-right: 10px; }
    </style>
</head>
<body>
    <h1>Transaktionen filtern</h1>

    <label for="userFilter">Kunde:</label>
    <select id="userFilter">
        <option value="">Alle</option>
    </select>

    <label for="typeFilter">Typ:</label>
    <select id="typeFilter">
        <option value="">Alle</option>
        <option value="deposit">Einzahlung</option>
        <option value="withdrawal">Auszahlung</option>
        <option value="bonus">Bonus</option>
    </select>

    <label for="dateFrom">Von:</label>
    <input type="date" id="dateFrom">
    <label for="dateTo">Bis:</label>
    <input type="date" id="dateTo">
    <button onclick="loadTransactions()">Filtern</button>

    <table>
        <thead>
            <tr>
                <th>Kunde</th>
                <th>Betrag (â‚¬)</th>
                <th>Typ</th>
                <th>Datum</th>
            </tr>
        </thead>
        <tbody id="transactionsTable"></tbody>
    </table>

    <script>
        const supabase = window.supabase.createClient(
            "https://sosiczexxefsrqwzlruf.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        );

        async function loadUsers() {
            const { data } = await supabase.from("kunden").select("id, name");
            const select = document.getElementById("userFilter");
            data.forEach(k => {
                const option = document.createElement("option");
                option.value = k.id;
                option.textContent = k.name;
                select.appendChild(option);
            });
        }

        async function loadTransactions() {
            const user = document.getElementById("userFilter").value;
            const type = document.getElementById("typeFilter").value;
            const from = document.getElementById("dateFrom").value;
            const to = document.getElementById("dateTo").value;

            let query = supabase.from("transactions").select("*, kunden(name)").order("timestamp", { ascending: false });
            if (user) query = query.eq("user_id", user);
            if (type) query = query.eq("type", type);
            if (from) query = query.gte("timestamp", from);
            if (to) query = query.lte("timestamp", to);

            const { data, error } = await query;
            const tbody = document.getElementById("transactionsTable");
            tbody.innerHTML = "";

            if (data) {
                data.forEach(t => {
                    const row = `<tr>
                        <td>${t.kunden.name}</td>
                        <td>${t.amount}</td>
                        <td>${t.type}</td>
                        <td>${new Date(t.timestamp).toLocaleString()}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
            }
        }

        loadUsers();
        loadTransactions();
    </script>
</body>
</html>
